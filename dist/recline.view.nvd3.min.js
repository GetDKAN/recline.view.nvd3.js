/*! recline.view.nvd3 v0.1 */
this.recline=this.recline||{},this.recline.View=this.recline.View||{},this.recline.View.nvd3=this.recline.View.nvd3||{},function(a,b){"use strict";function c(a){return function(b,c,d,e){return _.template(a)({key:b,y:c,e:d,graph:e})}}function d(a){return a=a||"",a+(1e16*Math.random()).toFixed(0)}function e(a){var b=_.last(a.split("::")),c=_.first(a.split("::")),d={String:_.identity,Date:_.compose(d3.time.format(b||"%x"),_.instantiate(Date)),Number:d3.format(b||".02f")};return d[c]}var f=640,g=480,h=1e3,i={tickFormat:e,valueFormat:e,average:_.iteratee,x:_.iteratee,y:_.iteratee,ranges:_.iteratee,markers:_.iteratee,measures:_.iteratee,rangeLabels:_.iteratee,markerLabels:_.iteratee,measureLabels:_.iteratee,tooltipContent:c,pointSize:_.iteratee};b.Base=Backbone.View.extend({template:'<div class="recline-graph row">{{data}}<div class="{{columnClass}} {{viewId}}"style="display: block;"><div id="{{viewId}}"><svg version="1.1" xmlns="http://www.w3.org/2000/svg"  height="{{height}}" width="{{width}}"></svg></div></div></div> ',initialize:function(b){var c=this;c.$el=a(c.el),c.graphType=c.graphType||"multiBarChart",c.uuid=d("nvd3chart_"),c.state=b.state,c.xfield=c.state.get("options").x,c.series=c.getSeries(),c.xDataType=c.state.get("xDataType"),c.chartMap=d3.map(),c.state.listenTo(c.state,"change",_.bind(c.render,c))},getLayoutParams:function(){var a=this,b={columnClass:"col-md-12",width:a.state.get("width")||a.$el.innerWidth()||f,height:a.state.get("height")||g};return b},render:function(){var a,b,c,d=this;c=d.getLayoutParams(),a=d.model.toTemplateJSON(),a.viewId=d.uuid,_.extend(a,c),b=Mustache.render(d.template,a),d.$el.html(b),d.$graph=d.$el.find(".panel."+a.viewId),d.trigger("chart:endDrawing");var e=d.needForceX(d.model.records,d.graphType);return d.state.set("computeXLabels",e,{silent:!0}),d.state.set("group",d.model.records.length>h||d.state.get("group",{silent:!0})),d.series=d.createSeries(d.model.records),nv.addGraph(function(){return d.chart=d.createGraph(d.graphType),d.configureDefaultFormats(d.chart,d.state.get("options")),d.alterChart&&d.alterChart(d.chart),d3.select("#"+d.uuid+" svg").datum(d.series).transition().duration(d.state.get("transitionTime")||500).call(d.chart),"discreteBarChart"===d.graphType&&d.state.get("options")&&d.state.get("options").reduceXTicks&&d.reduceXTicks(),nv.utils.windowResize(d.updateChart.bind(d)),d.chart}),d},updateChart:function(){var a=this;d3.select("#"+a.uuid+" svg").transition().duration(a.state.get("transitionTime")||500).call(a.chart)},reduceXTicks:function(){var a=this,b=a.getLayoutParams(a.state.get("mode"));d3.select(".nv-x.nv-axis > g").selectAll("g").filter(function(c,d){return d%Math.ceil(a.model.records.length/(b.width/100))!==0}).selectAll("text, line").style("opacity",0)},createSeries:function(a){var b,c=this;return c.xfield&&c.getSeries()?(a=a.toJSON(),b=_.map(c.getSeries(),function(b){var d={};return d.key=b,a=c.state.get("group")?_.reportBy(a,c.xfield,c.series):a,a=_.sortBy(a,c.getSort(c.state.get("sort"))),d.values=_.map(a,function(a,d){var e={};return c.state.get("computeXLabels")?(c.chartMap.set(d,a[c.xfield]),e.label=e[c.xfield],e[c.xfield]=d):e[c.xfield]=_.cast(a[c.xfield],c.xDataType),e.y=_.cast(a[b],_.inferType(a[b])),_.defaults(e,a)}),d})):[]},getSort:function(a){return a&&"default"!==a?a:_.identity},needForceX:function(a,b){var c=this,d=c.xfield;return a=a.toJSON(),_.some(a,function(a){return"String"===_.inferType(a[d])})&&"discreteBarChart"!==b&&"multiBarChart"!==b&&"multiBarHorizontalChart"!==b},createGraph:function(a){var b=this,c=nv.models[a]();return b.configure(b.state,c),c},getSeries:function(){var a=this;return a.state.get("seriesFields")},wrapValue:function(a,b,c){return _.isFunction(b)?b:a in c?c[a](b):b},prepareOptions:function(a){var b=this;return _.reduce(a,function(a,c,d){return a[d]=b.wrapValue(d,c,i),a},{})},configure:function(a,b){var c=this,d=a.get("options"),e=c.getAxesNames(d),f=_.pick(d,e),g=_.first(_.values(_.pick(d,"margin"))),h=_.omit(d,_.union(e,["margin"]));c.configureChart(b,c.prepareOptions(h)),_.each(_.keys(f),function(a){c.configureAxis(b,c.prepareOptions(f[a],a),a)}),c.configureMargins(b,g)},getAxesNames:function(a){var b=["xAxis","x2Axis","y1Axis","y2Axis","y3Axis","y4Axis","yAxis","yAxis1","yAxis2"];return _.filter(_.keys(a),function(a){return _.contains(b,a)})},getNotFormattedAxes:function(a,b){var c=this,d=c.getAxesNames(a);return _.filter(d,_.negate(_.partial(c.hasFormat,b)))},hasFormat:function(a,b){return!!a[b]&&!!a[b].tickFormat},configureDefaultFormats:function(a,b){var c=this;_.each(c.getNotFormattedAxes(a,b),function(d){var e=a[d],f=d.charAt(0),g=c.model.records.toJSON(),h=c.state.get("computeXLabels");"y"===f?f=_.iteratee(_.first(c.state.get("seriesFields"))):"x"===f&&(f=_.iteratee(c.xfield)),_.isFunction(b[f])?f=b[f]:_.isString(b[f])&&(f=_.iteratee(b[f]));var i=f(_.first(g)),j=_.inferType(i);e.tickFormat(c.getFormatByType(j,h))})},getFormatByType:function(a,b){var c=this;if(b)return c.chartMap.get.bind(c.chartMap);var d={String:_.identity,Date:_.compose(d3.time.format("%x"),_.instantiate(Date)),Number:d3.format(".02f")};return d[a]},configureChart:function(a,b){a.options(b)},configureAxis:function(a,b,c){_.has(a,c)&&a[c].options(b)},configureMargins:function(a,b){b&&a.margin(b)}})}(jQuery,this.recline.View.nvd3),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(a,b,c){"use strict";b.cumulativeLineChart=c.View.nvd3.Base.extend({initialize:function(a){var b=this;b.graphType="cumulativeLineChart",c.View.nvd3.Base.prototype.initialize.call(b,a)},render:function(){var a=this;c.View.nvd3.Base.prototype.render.call(a,{})},getDefaults:function(){return{useInteractiveGuideline:!0,tooltips:!0}}})}(jQuery,this.recline.View.nvd3,this.recline),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(a,b,c){"use strict";b.discreteBarChart=c.View.nvd3.Base.extend({initialize:function(a){var b=this;b.graphType="discreteBarChart",c.View.nvd3.Base.prototype.initialize.call(b,a)},render:function(){var a=this;c.View.nvd3.Base.prototype.render.call(a,{})},getDefaults:function(){return{computeXLabels:!1,options:{tooltips:!0}}}})}(jQuery,this.recline.View.nvd3,this.recline),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(a,b,c){"use strict";b.lineChart=c.View.nvd3.Base.extend({initialize:function(a){var b=this;b.graphType="lineChart",c.View.nvd3.Base.prototype.initialize.call(b,a),b.state.set("computeXLabels",!0)},render:function(){var a=this;c.View.nvd3.Base.prototype.render.call(a,{})},getDefaults:function(){var a=this;return{options:{useInteractiveGuideline:!0,tooltips:!0,xAxis:{tickFormat:function(b){return a.chartMap?a.chartMap.get(b):b}}}}}})}(jQuery,this.recline.View.nvd3,this.recline),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(a,b,c){"use strict";b.lineWithFocusChart=c.View.nvd3.Base.extend({initialize:function(a){var b=this;b.graphType="lineWithFocusChart",c.View.nvd3.Base.prototype.initialize.call(b,a),b.state.set("computeXLabels",!0)},render:function(){var a=this;c.View.nvd3.Base.prototype.render.call(a,{})},getDefaults:function(){var a=this;return{options:{tooltips:!0,xAxis:{tickFormat:function(b){return a.chartMap?a.chartMap.get(b):b}}}}}})}(jQuery,this.recline.View.nvd3,this.recline),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(a,b,c){"use strict";b.multiBarChart=c.View.nvd3.Base.extend({initialize:function(a){var b=this;b.graphType="multiBarChart",c.View.nvd3.Base.prototype.initialize.call(b,a)},render:function(){var a=this;c.View.nvd3.Base.prototype.render.call(a,{})},getDefaults:function(){return{computeXLabels:!1,options:{reduceXTicks:!0,tooltips:!0}}}})}(jQuery,this.recline.View.nvd3,this.recline),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(a,b,c){"use strict";b.multiBarHorizontalChart=c.View.nvd3.Base.extend({initialize:function(a){var b=this;b.graphType="multiBarHorizontalChart",c.View.nvd3.Base.prototype.initialize.call(b,a),b.state.set("computeXLabels",!1)},render:function(){var a=this;c.View.nvd3.Base.prototype.render.call(a,{})},getDefaults:function(){return{options:{tooltips:!0,reduceXTicks:!1}}}})}(jQuery,this.recline.View.nvd3,this.recline),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(a,b,c){"use strict";b.pieChart=c.View.nvd3.Base.extend({initialize:function(a){var b=this;b.graphType="pieChart",c.View.nvd3.Base.prototype.initialize.call(b,a)},render:function(){var a=this;c.View.nvd3.Base.prototype.render.call(a,{})},alterChart:function(a){var b=this;b.series.length>10&&a.showLegend(!1)},createSeries:function(a){var b=this;a=a.toJSON();var c=_.first(b.state.get("seriesFields"));return a=b.state.get("group")?_.reportBy(a,b.state.get("xfield"),b.state.get("seriesFields")):a,_.map(a,function(a){return{y:b.y(a,c),x:b.x(a,b.state.get("xfield"))}})},getDefaults:function(){return{options:{showLabels:!0,labelType:"percent",tooltips:!0}}}})}(jQuery,this.recline.View.nvd3,this.recline),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(a,b,c){"use strict";b.scatterChart=c.View.nvd3.Base.extend({initialize:function(a){var b=this;b.graphType="scatterChart",c.View.nvd3.Base.prototype.initialize.call(b,a),b.state.set("computeXLabels",!0)},render:function(){var a=this;c.View.nvd3.Base.prototype.render.call(a,{})},getDefaults:function(){var a=this;return{options:{showDistX:!0,showDistY:!0,onlyCircles:!1,xAxis:{tickFormat:function(b){return a.chartMap?a.chartMap.get(b):b}}}}}})}(jQuery,this.recline.View.nvd3,this.recline),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(a,b,c){"use strict";b.stackedAreaChart=c.View.nvd3.Base.extend({initialize:function(a){var b=this;b.graphType="stackedAreaChart",c.View.nvd3.Base.prototype.initialize.call(b,a),b.state.set("computeXLabels",!0)},render:function(){var a=this;c.View.nvd3.Base.prototype.render.call(a,{})},getDefaults:function(){return{options:{useInteractiveGuideline:!0,tooltips:!0,xAxis:{tickFormat:function(a){return d3.time.format("%Y")(new Date(a))}}}}}})}(jQuery,this.recline.View.nvd3,this.recline),jQuery(function(){"use strict";_.mixin({getFields:function(a){var b=[];try{b=_.pluck(a.fields.toJSON(),"id")}catch(c){console.error("Error retrieving dataset fields")}return b},applyOption:function(a,b){return _.map(a,function(a){return a.selected=_.inArray(b,a.value)?!0:!1,a})},arrayToOptions:function(a){return _.map(a,function(a){return{name:a,value:a,selected:!1}})}})});